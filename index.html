<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0">
    <title>H-Boost æˆ˜æœ¯è®¡ç®—å™¨ Â· å¤šæ¬¡äº¤æ˜“/é˜¶æ¢¯/85%æŠ˜æ‰£/ç´¯ç§¯æ‹‰ç›˜</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: #eaf1f7;
            margin: 0;
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .calc-container {
            max-width: 1300px;
            width: 100%;
            background: white;
            border-radius: 40px;
            box-shadow: 0 30px 45px -15px rgba(18,52,77,0.18);
            padding: 2.2rem 2rem;
        }
        h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0 0 0.2rem;
            background: linear-gradient(145deg, #0a384b, #1d5770);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .sub {
            color: #3a6075;
            font-size: 0.95rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid #d2e3ed;
            padding-bottom: 1.2rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
        }
        .badge {
            background: #1f5770;
            color: white;
            padding: 0.25rem 0.9rem;
            border-radius: 40px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            margin-right: 0.3rem;
        }
        .mode-selector {
            display: flex;
            gap: 1rem;
            background: #edf5fa;
            padding: 0.3rem;
            border-radius: 60px;
        }
        .mode-btn {
            padding: 0.4rem 1.4rem;
            border-radius: 40px;
            border: none;
            background: transparent;
            font-weight: 600;
            color: #1a4b5e;
            cursor: pointer;
            transition: 0.1s;
            font-size: 0.85rem;
        }
        .mode-btn.active {
            background: white;
            box-shadow: 0 4px 10px rgba(0,60,100,0.08);
            color: #0a3140;
        }
        .panel-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1.5rem;
        }
        @media (max-width: 1000px) {
            .panel-grid { grid-template-columns: 1fr; }
        }
        .input-panel {
            background: #f7fcff;
            border-radius: 28px;
            padding: 1.8rem;
            border: 1px solid #cbe0ec;
        }
        .output-panel {
            background: linear-gradient(145deg, #f2faff, #ffffff);
            border-radius: 28px;
            padding: 1.8rem;
            border: 1px solid #cbe0ec;
        }
        .param-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 1.1rem;
        }
        .param-label {
            flex: 0 0 160px;
            font-weight: 600;
            color: #13506b;
            font-size: 0.9rem;
        }
        .param-input {
            flex: 1 1 200px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        input[type=number] {
            width: 140px;
            padding: 0.6rem 1rem;
            border: 1px solid #b4cfdf;
            border-radius: 20px;
            font-size: 0.95rem;
            background: white;
        }
        input[type=range] {
            width: 150px;
            height: 6px;
            background: #c8ddec;
            border-radius: 10px;
            -webkit-appearance: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #1b7a99;
            border-radius: 20px;
            cursor: pointer;
            border: 2px solid white;
        }
        .unit {
            color: #3e6b80;
            font-size: 0.85rem;
        }
        .slider-value {
            min-width: 50px;
            background: #e2eef7;
            padding: 0.2rem 0.8rem;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.9rem;
            text-align: center;
        }
        .stat-big {
            font-size: 2rem;
            font-weight: 700;
            color: #0b5a4a;
            line-height: 1.1;
        }
        .stat-label-sm {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: #4f7589;
            font-weight: 600;
        }
        .result-card {
            background: white;
            border-radius: 20px;
            padding: 1.2rem;
            margin: 1rem 0;
            border: 1px solid #d7e7f0;
        }
        .protocol-box {
            background: #e3f0f5;
            border-radius: 20px;
            padding: 1rem 1.2rem;
            margin-top: 1.2rem;
        }
        .ladder-table {
            background: #f3f9fd;
            border-radius: 16px;
            padding: 0.8rem;
            margin: 0.8rem 0;
            font-size: 0.8rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            text-align: left;
            color: #0f556a;
            font-weight: 600;
            font-size: 0.7rem;
            padding: 0.3rem 0.2rem;
        }
        td {
            padding: 0.3rem 0.2rem;
            border-bottom: 1px solid #cde0eb;
        }
        .opt-tag {
            background: #ffd966;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.7rem;
            color: #3a3a00;
        }
        button {
            background: #1d6f8b;
            border: none;
            color: white;
            padding: 0.6rem 1.5rem;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
        }
        button:hover { background: #0e556d; }
    </style>
</head>
<body>
<div class="calc-container">
    <h1>âš¡ H-Boost æˆ˜æœ¯è®¡ç®—å™¨</h1>
    <div class="sub">
        <span><span class="badge">å¤šæ¬¡äº¤æ˜“</span><span class="badge">Boost 85%</span><span class="badge">é˜¶æ¢¯/çº¿æ€§</span><span class="badge">ç´¯ç§¯æ‹‰ç›˜</span></span>
        <div class="mode-selector" id="modeSelector">
            <button id="modeLinear" class="mode-btn active">ğŸ“Š çº¿æ€§ç©ºæŠ•</button>
            <button id="modeLadder" class="mode-btn">ğŸ¯ é˜¶æ¢¯ç§¯åˆ†</button>
        </div>
    </div>

    <div class="panel-grid">
        <!-- å·¦ä¾§è¾“å…¥åŒº -->
        <div class="input-panel">
            <h3 style="margin-top:0; margin-bottom:1.5rem; font-weight:600; color:#135664;">ğŸ”§ ä½ çš„ç­–ç•¥</h3>
            
            <div class="param-row">
                <span class="param-label">ğŸ”µ è´¨æŠ¼U</span>
                <div class="param-input">
                    <input type="number" id="stakeU" value="10000" step="1000" min="100">
                    <span class="unit">U</span>
                </div>
            </div>
            <div class="param-row">
                <span class="param-label">ğŸ’ Hå½“å‰å¸‚ä»·</span>
                <div class="param-input">
                    <input type="number" id="hPrice" value="0.001" step="0.0001" min="0.0001" max="0.01">
                    <span class="unit">U</span>
                </div>
            </div>
            <div class="param-row">
                <span class="param-label">ğŸ§¾ veHåŠ æˆ</span>
                <div class="param-input">
                    <input type="range" id="boostMulti" min="1" max="3" step="0.1" value="1">
                    <span id="boostValue" class="slider-value">1.0x</span>
                </div>
            </div>
            <div class="param-row">
                <span class="param-label">ğŸ” äº¤æ˜“è½®æ•°</span>
                <div class="param-input">
                    <input type="range" id="tradeRounds" min="1" max="20" step="1" value="1">
                    <span id="roundsValue" class="slider-value">1</span>
                </div>
            </div>
            <div class="param-row">
                <span class="param-label">ğŸ“† ç´¯ç§¯å¤©æ•°</span>
                <div class="param-input">
                    <input type="range" id="accumDays" min="1" max="30" step="1" value="1">
                    <span id="daysValue" class="slider-value">1</span>
                </div>
            </div>
            <div class="param-row">
                <span class="param-label">ğŸšï¸ Boostæœ‰æ•ˆç³»æ•°</span>
                <div class="param-input">
                    <input type="range" id="boostFactor" min="50" max="100" step="1" value="85">
                    <span id="factorValue" class="slider-value">85%</span>
                </div>
            </div>
            <div class="param-row">
                <span class="param-label">ğŸ“ˆ æ‹‰ç›˜åå–å‡ºä»·</span>
                <div class="param-input">
                    <input type="number" id="sellPrice" value="0.0012" step="0.0001" min="0.0001">
                    <span class="unit">U</span>
                </div>
            </div>
            
            <!-- çº¿æ€§å‚æ•°åŒº -->
            <div id="linearParams">
                <div class="param-row">
                    <span class="param-label">ğŸ çº¿æ€§ç©ºæŠ•ç‡</span>
                    <div class="param-input">
                        <input type="range" id="airdropRate" min="0" max="5" step="0.1" value="1.5">
                        <span id="airdropValue" class="slider-value">1.50%</span>
                    </div>
                </div>
            </div>
            
            <!-- é˜¶æ¢¯å‚æ•°åŒº (é»˜è®¤éšè—) -->
            <div id="ladderParams" style="display:none;">
                <div class="ladder-table">
                    <div style="font-weight:700; margin-bottom:0.3rem;">ğŸ† Rainbow é˜¶æ¢¯</div>
                    <table>
                        <thead><tr><th>å®é™…äº¤æ˜“é¢(U)</th><th>æœ‰æ•ˆé‡</th><th>ç§¯åˆ†</th></tr></thead>
                        <tbody id="ladderTbody"></tbody>
                    </table>
                </div>
                <div class="param-row">
                    <span class="param-label">ğŸ« å¥–æ± (RNBW)</span>
                    <div class="param-input">
                        <input type="number" id="prizePool" value="3500000" step="100000">
                    </div>
                </div>
                <div class="param-row">
                    <span class="param-label">ğŸ“Š æ€»ç§¯åˆ†</span>
                    <div class="param-input">
                        <input type="number" id="totalPoints" value="37996.64" step="100">
                    </div>
                </div>
                <div class="param-row">
                    <span class="param-label">ğŸ’° RNBWä»·æ ¼</span>
                    <div class="param-input">
                        <input type="number" id="rnbwPrice" value="0.1" step="0.01" min="0.01">
                        <span class="unit">U</span>
                    </div>
                </div>
            </div>

            <!-- å…¨ç½‘å‚æ•°ç®€ç‰ˆ -->
            <div style="margin-top:1.5rem; background:#ecf3fa; border-radius:18px; padding:1rem;">
                <div class="param-row">
                    <span class="param-label">ğŸŒ å…¨ç½‘TVL_U</span>
                    <div class="param-input">
                        <input type="number" id="globalTvl" value="1000000" step="100000">
                        <span class="unit">U</span>
                    </div>
                </div>
                <div class="param-row">
                    <span class="param-label">ğŸŒ å…¨ç½‘Hæ—¥äº¤æ˜“é¢</span>
                    <div class="param-input">
                        <input type="number" id="globalTx" value="100000" step="10000">
                        <span class="unit">U</span>
                    </div>
                </div>
                <button id="updateGlobalBtn" style="width:100%; margin-top:0.5rem;">æ›´æ–°çº¢çº¿çŠ¶æ€</button>
            </div>
        </div>
        
        <!-- å³ä¾§è¾“å‡ºåŒº -->
        <div class="output-panel">
            <h3 style="margin-top:0; margin-bottom:1.5rem; font-weight:600; color:#135664;">ğŸ“Š ä½ çš„æˆ˜æŠ¥</h3>
            
            <!-- åŸºç¡€å¥–åŠ± -->
            <div style="display:flex; justify-content:space-between;">
                <span class="stat-label-sm">ğŸ’° æ¯æ—¥Hå¥–åŠ± (Uç­‰å€¼)</span>
                <span style="font-size:1.8rem; font-weight:700; color:#0e5a4a;" id="dailyRewardU">50.00</span>
                <span class="unit">U</span>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:0.2rem;">
                <span class="stat-label-sm">â”• åˆå§‹Hæ•°é‡ (ç´¯ç§¯å)</span>
                <span style="font-weight:600;" id="totalHAmount">50,000</span>
                <span class="unit">H</span>
            </div>
            
            <!-- å¤šæ¬¡äº¤æ˜“æ±‡æ€» -->
            <div class="result-card">
                <div style="display:flex; justify-content:space-between;">
                    <span class="stat-label-sm">ğŸ”„ æ€»å®é™…äº¤æ˜“é¢</span>
                    <span style="font-size:1.6rem; font-weight:700;" id="totalTxVolume">50.00</span>
                    <span class="unit">U</span>
                </div>
                <div style="display:flex; justify-content:space-between; margin-top:0.4rem;">
                    <span class="stat-label-sm">ğŸ“‰ æ€»ç£¨æŸ (5%ç¨)</span>
                    <span style="font-weight:700;" id="totalTaxU">2.50</span>
                    <span class="unit">U</span>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span class="stat-label-sm">âœ… Boostæœ‰æ•ˆäº¤æ˜“é¢</span>
                    <span style="font-weight:700;" id="effectiveTxVolume">42.50</span>
                    <span class="unit">U (85%)</span>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span class="stat-label-sm">ğŸ ç©ºæŠ•æ”¶ç›Š</span>
                    <span style="font-weight:700; color:#1b6b5e;" id="airdropAmount">0.75</span>
                    <span class="unit">U</span>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span class="stat-label-sm">ğŸ”š å‰©ä½™Hä»·å€¼ (æ‹‰ç›˜ä»·)</span>
                    <span style="font-weight:700;" id="finalHValue">47.50</span>
                    <span class="unit">U</span>
                </div>
            </div>
            
            <!-- å‡€æ”¶ç›Šæ ¸å¿ƒ -->
            <div style="background:#dff0f9; border-radius:24px; padding:1.2rem 1.5rem; margin:1rem 0;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-weight:600; font-size:1.1rem;">âœ… å‡€æ—¥æ”¶ç›Š (U)</span>
                    <span style="font-size:2.2rem; font-weight:800; color:#0b543a;" id="netProfitU">48.25</span>
                    <span class="unit">U</span>
                </div>
                <div style="display:flex; justify-content:space-between; margin-top:0.2rem;">
                    <span>å¹´åŒ–æ”¶ç›Šç‡ (åŸºäºè´¨æŠ¼U)</span>
                    <span style="font-weight:700; background:#c1e5d8; padding:0.2rem 1rem; border-radius:50px;" id="aprValue">176.1%</span>
                </div>
            </div>
            
            <!-- é˜¶æ¢¯æœ€ä¼˜æ¡£ä½æç¤º -->
            <div id="ladderOptDiv" style="display:none; background:#ffefc0; border-radius:16px; padding:0.8rem 1.2rem; margin-bottom:1rem;">
                <span style="font-weight:700;">ğŸ¯ æœ€ä¼˜æ¡£ä½: </span><span id="optLadderTip">$8,000 (5ç§¯åˆ†)</span>
                <span style="margin-left:0.5rem; font-size:0.85rem;">è¾¹é™…ç©ºæŠ•ç‡ <span id="optMarginRate">0.58%</span></span>
            </div>
            
            <!-- åè®®çº¢çº¿ç›‘æµ‹ -->
            <div class="protocol-box">
                <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.5rem;">
                    <span style="background:#2c8392; width:10px; height:10px; border-radius:10px;"></span>
                    <span style="font-weight:600; color:#063b4a;">âš–ï¸ åè®®9.36%çº¢çº¿</span>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span>æ‰€éœ€æ—¥äº¤æ˜“é¢</span>
                    <span style="font-weight:700;" id="requiredTxVolume">93,600</span>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span>å…¨ç½‘çŠ¶æ€</span>
                    <span id="protocolStatus" style="font-weight:700;">âœ… è¾¾æ ‡</span>
                </div>
            </div>
            
            <p style="font-size:0.75rem; color:#3f687d; margin-top:1rem;">* å‡€æ”¶ç›Š = å‰©ä½™Hä»·å€¼(æ‹‰ç›˜ä»·) + ç©ºæŠ• - åˆå§‹å¥–åŠ±Uä»·å€¼ã€‚ç´¯ç§¯å¤©æ•°å€å¢åˆå§‹Hæ•°é‡ã€‚</p>
        </div>
    </div>

    <div style="margin-top:1.8rem; font-size:0.85rem; color:#2e5e70; text-align:center; border-top:1px solid #cde0eb; padding-top:1.5rem;">
        âš¡ ç¤¾åŒºæ‹‰ç›˜ç­–ç•¥ï¼šæ¯æ™š20:00å‘Hï¼Œæ¬¡æ—©09:00æ‹‰ç›˜ï¼Œæ­¤å¤„â€œæ‹‰ç›˜åå–å‡ºä»·â€å·²ä½“ç°é¢„æœŸç®¡ç†æ”¶ç›Šã€‚ç£¨æŸ=æ¯è½®5%ï¼ŒBoostæœ‰æ•ˆç³»æ•°é»˜è®¤85%ã€‚
    </div>
</div>

<script>
    (function() {
        'use strict';

        // ----- å…ƒç´ ç»‘å®š -----
        const stakeU = document.getElementById('stakeU');
        const hPrice = document.getElementById('hPrice');
        const sellPrice = document.getElementById('sellPrice');
        const boostMulti = document.getElementById('boostMulti');
        const boostValue = document.getElementById('boostValue');
        const tradeRounds = document.getElementById('tradeRounds');
        const roundsValue = document.getElementById('roundsValue');
        const accumDays = document.getElementById('accumDays');
        const daysValue = document.getElementById('daysValue');
        const boostFactor = document.getElementById('boostFactor');
        const factorValue = document.getElementById('factorValue');

        // çº¿æ€§
        const airdropRate = document.getElementById('airdropRate');
        const airdropValue = document.getElementById('airdropValue');
        // é˜¶æ¢¯
        const prizePool = document.getElementById('prizePool');
        const totalPoints = document.getElementById('totalPoints');
        const rnbwPrice = document.getElementById('rnbwPrice');
        // å…¨å±€
        const globalTvl = document.getElementById('globalTvl');
        const globalTx = document.getElementById('globalTx');

        // è¾“å‡º
        const dailyRewardU = document.getElementById('dailyRewardU');
        const totalHAmount = document.getElementById('totalHAmount');
        const totalTxVolume = document.getElementById('totalTxVolume');
        const totalTaxU = document.getElementById('totalTaxU');
        const effectiveTxVolume = document.getElementById('effectiveTxVolume');
        const airdropAmount = document.getElementById('airdropAmount');
        const finalHValue = document.getElementById('finalHValue');
        const netProfitU = document.getElementById('netProfitU');
        const aprValue = document.getElementById('aprValue');
        const requiredTxVolume = document.getElementById('requiredTxVolume');
        const protocolStatus = document.getElementById('protocolStatus');
        const ladderOptDiv = document.getElementById('ladderOptDiv');
        const optLadderTip = document.getElementById('optLadderTip');
        const optMarginRate = document.getElementById('optMarginRate');

        // æ¨¡å¼
        const modeLinearBtn = document.getElementById('modeLinear');
        const modeLadderBtn = document.getElementById('modeLadder');
        const linearParams = document.getElementById('linearParams');
        const ladderParams = document.getElementById('ladderParams');
        const ladderTbody = document.getElementById('ladderTbody');

        // é˜¶æ¢¯æ•°æ®
        const ladderSteps = [
            { volume: 500, points: 1 },
            { volume: 1000, points: 2 },
            { volume: 2000, points: 3 },
            { volume: 4000, points: 4 },
            { volume: 8000, points: 5 },
            { volume: 16000, points: 6 },
            { volume: 32000, points: 7 },
            { volume: 64000, points: 8 }
        ];

        // æ¸²æŸ“é˜¶æ¢¯è¡¨æ ¼
        function renderLadderTable() {
            let html = '';
            ladderSteps.forEach(step => {
                let actual = Math.ceil(step.volume / (parseFloat(boostFactor.value)/100));
                html += `<tr><td>$${actual}</td><td>$${step.volume}</td><td>${step.points}</td></tr>`;
            });
            ladderTbody.innerHTML = html;
        }

        // è·å–é˜¶æ¢¯ç§¯åˆ† (åŸºäºæœ‰æ•ˆäº¤æ˜“é¢)
        function getLadderPoints(effectiveTx) {
            let points = 0, achieved = 0;
            for (let i = ladderSteps.length-1; i>=0; i--) {
                if (effectiveTx >= ladderSteps[i].volume) {
                    points = ladderSteps[i].points;
                    achieved = ladderSteps[i].volume;
                    break;
                }
            }
            return { points, achieved };
        }

        // æœ€ä¼˜æ¡£ä½ (åŸºäºè¾¹é™…ç©ºæŠ•ç‡)
        function calcOptimalLadder() {
            const pool = parseFloat(prizePool.value) || 3500000;
            const total = parseFloat(totalPoints.value) || 37996.64;
            const price = parseFloat(rnbwPrice.value) || 0.1;
            const pointValueU = (pool / total) * price;
            let bestMargin = 0, bestVol = 0, bestPts = 0;
            ladderSteps.forEach(step => {
                let airdropVal = step.points * pointValueU;
                let margin = airdropVal / (step.volume / (parseFloat(boostFactor.value)/100)); // å®é™…äº¤æ˜“é¢å¯¹åº”è¾¹é™…
                if (margin > bestMargin) {
                    bestMargin = margin;
                    bestVol = step.volume;
                    bestPts = step.points;
                }
            });
            return { volume: bestVol, points: bestPts, marginRate: bestMargin * 100 };
        }

        // å¤šæ¬¡äº¤æ˜“æ¨¡æ‹Ÿ (åŸºäºåˆå§‹Hæ•°é‡ã€è½®æ•°)
        function simulateMulti(initialH, rounds) {
            let remaining = initialH;
            let totalTx = 0;
            for (let i=0; i<rounds; i++) {
                let tx = remaining * parseFloat(hPrice.value);
                totalTx += tx;
                remaining *= 0.95;   // æ‰£é™¤5%ç£¨æŸ
            }
            return { totalTx, remainingH: remaining };
        }

        // ä¸»æ›´æ–°
        function updateAll() {
            // è¯»å‚æ•°
            let stake = parseFloat(stakeU.value) || 10000;
            let price = parseFloat(hPrice.value) || 0.001;
            let sell = parseFloat(sellPrice.value) || price;
            let boost = parseFloat(boostMulti.value) || 1.0;
            let rounds = parseInt(tradeRounds.value) || 1;
            let days = parseInt(accumDays.value) || 1;
            let factor = parseFloat(boostFactor.value) / 100;
            let tvl = parseFloat(globalTvl.value) || 1000000;
            let txGlobal = parseFloat(globalTx.value) || 100000;

            boostValue.innerText = boost.toFixed(1) + 'x';
            roundsValue.innerText = rounds;
            daysValue.innerText = days;
            factorValue.innerText = (factor*100).toFixed(0) + '%';

            // æ¯æ—¥å¥–åŠ±Uç­‰å€¼ (å•æ—¥)
            let dailyReward = stake * 0.005 * boost;
            // ç´¯ç§¯å¥–åŠ±Uç­‰å€¼
            let totalRewardU = dailyReward * days;
            // åˆå§‹Hæ•°é‡
            let initialH = totalRewardU / price;
            // å¤šæ¬¡äº¤æ˜“æ¨¡æ‹Ÿ
            let sim = simulateMulti(initialH, rounds);
            let totalTx = sim.totalTx;
            let remainingH = sim.remainingH;
            let remainingValue = remainingH * sell;  // æŒ‰æ‹‰ç›˜ä»·å–å‡º

            // ç£¨æŸæ€»Uç­‰å€¼ (åŸºäºå½“å‰ä»·? ä½†ç£¨æŸæ˜¯æŒ‰Hæ‰£ï¼Œæˆ‘ä»¬ç”¨åˆå§‹ä»·è®¡ç®—ç£¨æŸçš„Uä»·å€¼)
            let totalTax = 0;
            let tempH = initialH;
            for (let i=0; i<rounds; i++) {
                let taxH = tempH * 0.05;
                totalTax += taxH * price;   // ç£¨æŸæŒ‰äº¤æ˜“æ—¶çš„Hä»·? ç»Ÿä¸€ç”¨å½“å‰ä»·ç®€åŒ–
                tempH -= taxH;
            }

            // Boostæœ‰æ•ˆäº¤æ˜“é¢
            let effectiveTx = totalTx * factor;

            // ç©ºæŠ•æ”¶ç›Š
            let airdropU = 0;
            let isLadder = ladderParams.style.display !== 'none';
            if (isLadder) {
                const pool = parseFloat(prizePool.value) || 3500000;
                const totalPts = parseFloat(totalPoints.value) || 37996.64;
                const rnbwPriceU = parseFloat(rnbwPrice.value) || 0.1;
                const pointValueU = (pool / totalPts) * rnbwPriceU;
                let { points } = getLadderPoints(effectiveTx);
                airdropU = points * pointValueU;
                // é˜¶æ¢¯æœ€ä¼˜æç¤º
                ladderOptDiv.style.display = 'block';
                let opt = calcOptimalLadder();
                optLadderTip.innerText = `$${opt.volume}æœ‰æ•ˆ (${opt.points}ç§¯åˆ†)`;
                optMarginRate.innerText = opt.marginRate.toFixed(3) + '%';
            } else {
                let linearRate = parseFloat(airdropRate.value) / 100;
                airdropU = effectiveTx * linearRate;
                ladderOptDiv.style.display = 'none';
            }

            // å‡€æ”¶ç›Š = å‰©ä½™Hä»·å€¼ + ç©ºæŠ• - æ€»å¥–åŠ±Uä»·å€¼
            let netU = remainingValue + airdropU - totalRewardU;
            let apr = (netU / stake) / days * 365 * 100;  // è€ƒè™‘ç´¯ç§¯å¤©æ•°

            // åè®®çº¢çº¿
            let required = tvl * 0.0936;
            requiredTxVolume.innerText = Math.round(required).toLocaleString();
            if (txGlobal >= required) {
                protocolStatus.innerText = 'âœ… å¥åº· (äº¤æ˜“é¢è¾¾æ ‡)';
                protocolStatus.style.color = '#0a5e44';
            } else {
                protocolStatus.innerText = 'âš ï¸ ä¸è¶³ (æ¶ˆè€—å¥–åŠ±æ± )';
                protocolStatus.style.color = '#aa3025';
            }

            // æ›´æ–°UI
            dailyRewardU.innerText = dailyReward.toFixed(2);
            totalHAmount.innerText = Math.round(initialH).toLocaleString();
            totalTxVolume.innerText = totalTx.toFixed(2);
            totalTaxU.innerText = totalTax.toFixed(2);
            effectiveTxVolume.innerText = effectiveTx.toFixed(2);
            airdropAmount.innerText = airdropU.toFixed(2);
            finalHValue.innerText = remainingValue.toFixed(2);
            netProfitU.innerText = netU.toFixed(2);
            aprValue.innerText = apr.toFixed(1) + '%';

            if (!isLadder) {
                let rate = parseFloat(airdropRate.value);
                airdropValue.innerText = rate.toFixed(2) + '%';
            }

            renderLadderTable();
        }

        // æ¨¡å¼åˆ‡æ¢
        function setMode(mode) {
            if (mode === 'linear') {
                linearParams.style.display = 'block';
                ladderParams.style.display = 'none';
                modeLinearBtn.classList.add('active');
                modeLadderBtn.classList.remove('active');
            } else {
                linearParams.style.display = 'none';
                ladderParams.style.display = 'block';
                modeLadderBtn.classList.add('active');
                modeLinearBtn.classList.remove('active');
                renderLadderTable();
            }
            updateAll();
        }

        // ç›‘å¬
        modeLinearBtn.addEventListener('click', ()=>setMode('linear'));
        modeLadderBtn.addEventListener('click', ()=>setMode('ladder'));

        stakeU.addEventListener('input', updateAll);
        hPrice.addEventListener('input', updateAll);
        sellPrice.addEventListener('input', updateAll);
        boostMulti.addEventListener('input', updateAll);
        tradeRounds.addEventListener('input', updateAll);
        accumDays.addEventListener('input', updateAll);
        boostFactor.addEventListener('input', updateAll);
        airdropRate.addEventListener('input', updateAll);
        prizePool.addEventListener('input', updateAll);
        totalPoints.addEventListener('input', updateAll);
        rnbwPrice.addEventListener('input', updateAll);
        globalTvl.addEventListener('input', updateAll);
        globalTx.addEventListener('input', updateAll);
        document.getElementById('updateGlobalBtn').addEventListener('click', updateAll);

        // åˆå§‹åŒ–
        setMode('linear');
        updateAll();
    })();
</script>
</body>
</html>